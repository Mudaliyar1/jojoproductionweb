<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="page-title"><%= member ? 'Edit Team Member' : 'Add Team Member' %></h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="/admin/team">Team</a></li>
                    <li class="breadcrumb-item active"><%= member ? 'Edit' : 'Add New' %></li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Team Member Details</h5>
                </div>
                <div class="card-body">
                    <form action="<%= member ? '/admin/about/team/edit/' + member._id : '/admin/about/team/add' %>" 
                          method="POST" 
                          enctype="multipart/form-data" 
                          id="teamMemberForm">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                <input type="text" 
                                       class="form-control <%= errors && errors.name ? 'is-invalid' : '' %>" 
                                       id="name" 
                                       name="name" 
                                       value="<%= member ? member.name : '' %>"
                                       required>
                                <% if (errors && errors.name) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.name %>
                                    </div>
                                <% } %>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="role" class="form-label">Role/Position <span class="text-danger">*</span></label>
                                <input type="text" 
                                       class="form-control <%= errors && errors.role ? 'is-invalid' : '' %>" 
                                       id="role" 
                                       name="role" 
                                       value="<%= member ? member.role : '' %>"
                                       required>
                                <% if (errors && errors.role) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.role %>
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="description" class="form-label">Description/Bio <span class="text-danger">*</span></label>
                                <textarea class="form-control <%= errors && errors.description ? 'is-invalid' : '' %>" 
                                          id="description" 
                                          name="description" 
                                          rows="4" 
                                          required><%= member ? member.description : '' %></textarea>
                                <% if (errors && errors.description) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.description %>
                                    </div>
                                <% } %>
                                <div class="form-text">Provide a brief bio or description of the team member.</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="order" class="form-label">Display Order</label>
                                <input type="number" 
                                       class="form-control <%= errors && errors.order ? 'is-invalid' : '' %>" 
                                       id="order" 
                                       name="order" 
                                       value="<%= member ? member.order : '0' %>"
                                       min="0">
                                <% if (errors && errors.order) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.order %>
                                    </div>
                                <% } %>
                                <div class="form-text">Lower numbers appear first (0 = no specific order).</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="image" class="form-label">Profile Image</label>
                                <div class="image-upload-area mb-3" 
                                     data-input="image" 
                                     data-preview="imagePreview"
                                     style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease;">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h6>Click to upload or drag and drop</h6>
                                    <p class="text-muted mb-0">PNG, JPG, JPEG up to 10MB</p>
                                </div>
                                <input type="file" 
                                       class="form-control d-none" 
                                       id="image" 
                                       name="image" 
                                       accept="image/*"
                                       data-preview="imagePreview">
                                
                                <% if (member && member.image) { %>
                                    <div class="current-image mb-3">
                                        <label class="form-label">Current Image</label>
                                        <div class="position-relative d-inline-block">
                                            <img src="<%= member.image %>" alt="<%= member.name %>" class="img-thumbnail" id="currentImage" style="max-width: 200px;">
                                            <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0" id="removeImage" style="border-radius: 50%; width: 30px; height: 30px;">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                <% } %>
                                
                                <img id="imagePreview" class="img-thumbnail mt-3 d-none" style="max-width: 200px;">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary me-2">
                                    <i class="fas fa-save me-2"></i><%= member ? 'Update Member' : 'Add Member' %>
                                </button>
                                <a href="/admin/team" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-2"></i>Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Member Preview</h5>
                </div>
                <div class="card-body">
                    <div class="team-member-preview text-center">
                        <div class="preview-image mb-3">
                            <img id="previewImage" src="<%= member && member.image ? member.image : '/images/placeholder-member.jpg' %>" 
                                 alt="Member preview" class="img-fluid rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                        </div>
                        <h6 id="previewName" class="preview-name mb-1"><%= member ? member.name : 'Member Name' %></h6>
                        <p id="previewRole" class="preview-role text-primary mb-2"><%= member ? member.role : 'Member Role' %></p>
                        <p id="previewDescription" class="preview-description text-muted">
                            <%= member ? member.description.substring(0, 100) + '...' : 'Member description will appear here...' %>
                        </p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Guidelines</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Use high-quality, professional headshots
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Keep role titles clear and descriptive
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Write engaging, concise bios
                        </li>
                        <li class="mb-0">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Set display order for better organization
                        </li>
                    </ul>
                </div>
            </div>

            <% if (member && member.createdAt) { %>
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Member Since</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-0 text-muted">
                            <i class="fas fa-calendar me-2"></i>
                            <%= new Date(member.createdAt).toLocaleDateString() %>
                        </p>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>

<style>
.image-upload-area:hover {
    background-color: var(--light-bg);
    border-color: var(--primary-color) !important;
}

.image-upload-area.drag-over {
    background-color: var(--light-bg);
    border-color: var(--primary-color) !important;
    transform: scale(1.02);
}

.team-member-preview {
    padding: 1rem;
}

.preview-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 1.1rem;
}

.preview-role {
    font-weight: 500;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.preview-description {
    font-size: 0.85rem;
    line-height: 1.5;
    margin-bottom: 0;
}

.preview-image img {
    border: 3px solid var(--border-color);
    transition: all 0.3s ease;
}

.preview-image img:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.current-image {
    position: relative;
}

#removeImage {
    opacity: 0;
    transition: opacity 0.3s ease;
}

.current-image:hover #removeImage {
    opacity: 1;
}

.form-label {
    font-weight: 500;
    color: var(--text-primary);
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
}

.is-invalid {
    border-color: var(--danger-color);
}

.invalid-feedback {
    display: block;
}

.form-text {
    font-size: 0.8rem;
    color: var(--text-muted);
}

@media (max-width: 768px) {
    .image-upload-area {
        padding: 1rem;
    }
    
    .team-member-preview {
        margin-top: 1rem;
    }
    
    .preview-image img {
        width: 120px !important;
        height: 120px !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Live preview functionality
    const nameInput = document.getElementById('name');
    const roleInput = document.getElementById('role');
    const descriptionInput = document.getElementById('description');
    
    const previewName = document.getElementById('previewName');
    const previewRole = document.getElementById('previewRole');
    const previewDescription = document.getElementById('previewDescription');
    const previewImage = document.getElementById('previewImage');

    nameInput.addEventListener('input', function() {
        previewName.textContent = this.value || 'Member Name';
    });

    roleInput.addEventListener('input', function() {
        previewRole.textContent = this.value || 'Member Role';
    });

    descriptionInput.addEventListener('input', function() {
        const text = this.value || 'Member description will appear here...';
        previewDescription.textContent = text.length > 100 ? text.substring(0, 100) + '...' : text;
    });

    // Image preview
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('imagePreview');
    const currentImage = document.getElementById('currentImage');
    const removeImageBtn = document.getElementById('removeImage');

    imageInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.classList.remove('d-none');
                previewImage.src = e.target.result;
                
                if (currentImage) {
                    currentImage.style.display = 'none';
                }
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    if (removeImageBtn) {
        removeImageBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to remove the current image?')) {
                // Add hidden input to indicate image removal
                const removeInput = document.createElement('input');
                removeInput.type = 'hidden';
                removeInput.name = 'removeImage';
                removeInput.value = 'true';
                document.getElementById('teamMemberForm').appendChild(removeInput);
                
                // Hide current image
                currentImage.parentElement.parentElement.style.display = 'none';
                previewImage.src = '/images/placeholder-member.jpg';
            }
        });
    }

    // Form validation
    document.getElementById('teamMemberForm').addEventListener('submit', function(e) {
        const name = nameInput.value.trim();
        const role = roleInput.value.trim();
        const description = descriptionInput.value.trim();
        
        let isValid = true;

        if (!name) {
            nameInput.classList.add('is-invalid');
            isValid = false;
        } else {
            nameInput.classList.remove('is-invalid');
        }

        if (!role) {
            roleInput.classList.add('is-invalid');
            isValid = false;
        } else {
            roleInput.classList.remove('is-invalid');
        }

        if (!description) {
            descriptionInput.classList.add('is-invalid');
            isValid = false;
        } else {
            descriptionInput.classList.remove('is-invalid');
        }

        if (description && description.length < 20) {
            e.preventDefault();
            alert('Description should be at least 20 characters long.');
            descriptionInput.focus();
            return false;
        }

        if (!isValid) {
            e.preventDefault();
            return false;
        }
    });
});
</script>